# -*- mode: sh; -*-
# vi: set ft=sh :

nix-cleanup() {
  nix-env --delete-generations old && \
    nix-collect-garbage;
}

nix-grep() {
  nix-env -f "${NIXPKGS_PATH}" -qaP \* \
    | "${GREPPAGE}" -i "$@";
}
alias nxg='nix-grep'

nix-grep-emacs() {
  nix-env -f "${NIXPKGS_PATH}" -qaP -A emacsPackages \
    | "${GREPPAGE}" -i "$@";
}
alias nxge='nix-grep-emacs'

nix-grep-haskell() {
  nix-env -f "${NIXPKGS_PATH}" -qaP -A haskellPackages \
    | "${GREPPAGE}" -i "$@";
}
alias nxgh='nix-grep-haskell'

nix-install() {
  # local ncpu
  # ncpu=$(($(sysctl -n hw.ncpu) / 2))
  # nix-env -f "${NIXPKGS_PATH}" -Q -j"$ncpu" -k -i "$@"
  nix-env -f "${NIXPKGS_PATH}" -Q -k -i "$@"
}
alias nxi='nix-install'

nix-update() {
  nix-install "$@";
}
alias nxu='nix-update'

nix-show-dependencies() {
  nix-store --query --references  "$(nix-instantiate '<nixpkgs>' -A "$1")";
}
alias nxd='nix-show-dependencies'

nixpkgs-sync() {
  git -C "${NIXPKGS_PATH}" pull --ff-only upstream master;
}
alias nxsync='nixpkgs-sync'
